# <p style="font-size:42px;font-weight: 600">Product Updates v0.9.30</p>


:::warning 
:warning: ***The following is not an exhaustive list of changes included in the mentioned release, but a set of changes that we felt deserved a special mention for their impact on builders.
Please don’t stop reading the release notes, this is not an effort to replace this information, but a complement to it.*** 
:::
<br/>

## <p style="font-size:28px;font-weight: 600">Changes Summary</p>


The two highlights for this release are the progress related to the disputes slashing/reward mechanism for the parachains protocol and the implementation of the fast unstake pallet implementation, which helps the users to have a better staking experience. Something to clarify is that these changes do not have a direct impact on the builders day to day, but there are significant changes in the protocol that are worth to be pointed out. For this reason, we believed these two fits within the Medium category. Also, from the support perspective, there are some chances that the underlying changes on the disputes protocol might bring some support efforts. 

On the FRAME side, this release brings two breaking changes where some of the types from the `frame_system::Config` trait pallets are renamed forcing all the definitions in pallets and runtimes to be renamed. Also, there are some progress in terms of Weights v2 project that involves a reorganization around the dispatch methods that used to be defined in the weights crate.
<br/>

## <p style="font-size:28px;font-weight: 600">Runtimes built on this release</p>

- **Rococo v9230**
- **Westend v9230**
- **Kusama v9230**
- **Polkadot v9230**
<br/>



# <p style="font-size:36px"> Release highlights</p>

## :heavy_exclamation_mark: <span style="font-size:28px;color: #D2001A;font-weight: 700">High Impact</span>

### [<span style="font-size:24px;color: #D2001A;font-weight: 600; text-decoration: underline;">BREAKING: Rename Origin</span>](https://github.com/paritytech/substrate/pull/12258)

### [<span style="font-size:24px;color: #D2001A;font-weight: 600; text-decoration: underline;">BREAKING: Rename Call & Event</span>](https://github.com/paritytech/substrate/pull/11981)


These PRs aim to rename the following types from the system Config trait: 

`Call` → `RuntimeCall`

`Event` → `RuntimeEvent`

`Origin` → `RuntimeOrigin`


<span style="color: #790252;font-size:18px;font-weight: 700">Why is this this important?</span>

As every pallet relies on the `frame_system::Config`  trait, all pallets and  runtimes  configurations should update these three associated types to match the new names, otherwise the compilation of the runtime will fail because of types mismatch.


<span style="color: #790252;font-size:18px;font-weight: 700">What was the motivation of this change?</span>


The reason behind this change is a need to distinguish runtime calls/events/origin (generated by `construct_runtime!` macro), with the pallet ones (generated from `#[pallet::call]`
 FRAME system macro)

There is an interesting discussion in this [Stack Exchange post](https://substrate.stackexchange.com/questions/3360/using-scheduler-pallet-to-schedule-contract-pallet-call) about the motivation for this change.

- **How to guide / Code Snippets (expand)**
    
    **How to apply these changes to the runtime?**
    
    [https://github.com/paritytech/substrate/pull/11981/files#diff-67684005af418e25ff88c2ae5b520f0c040371f1d817e03a3652e76b9485224a](https://github.com/paritytech/substrate/pull/11981/files#diff-67684005af418e25ff88c2ae5b520f0c040371f1d817e03a3652e76b9485224a)
    
    **How to apply these changes to a pallet?** 
    
    The `multisig` pallet is a good example since it contains a `RuntimeCall` type in its `Config`:
    
    [https://github.com/paritytech/substrate/pull/11981/files#diff-24d88dbb2cb8e8c19de1d235db557a306c189c2b0e90d40756776ba7261f2130](https://github.com/paritytech/substrate/pull/11981/files#diff-24d88dbb2cb8e8c19de1d235db557a306c189c2b0e90d40756776ba7261f2130)
    
---



### [<span style="font-size:24px;color: #D2001A;font-weight: 600; text-decoration: underline;">Create sp-weights crate to store weight primitivest</span>](https://github.com/paritytech/substrate/pull/12219)

In this PR, a new crate called `sp-weights` is created to store the `Weight` struct and its associated traits and types. Some existing types related to dispatch have also been relocated to `frame_support::dispatch` (they had never made sense to be put under the weights umbrella)

Aside from that, the main motivation here is to recognize that the notion of weights reaches far beyond FRAME, and so it should be a crate separate from `frame_support` or `sp-runtime`.



<span style="color: #790252;font-size:18px;font-weight: 700">What is important for the builders to know about this change?</span>

In addition to the new crate `sp-weights`, there is an important change here to take into account which is the relocation of dispatch methods. Even if the functionalities remains, builders will need to change the import statements in case they use this methods in their pallets. Example:

```rust
// Before
use frame_support::{
	dispatch::{DispatchError, DispatchResultWithPostInfo, Dispatchable, PostDispatchInfo},
	weights::{GetDispatchInfo, Pays, Weight},
};

// Now
use frame_support::{
	dispatch::{
		DispatchError, DispatchResultWithPostInfo, Dispatchable, GetDispatchInfo, Pays,
		PostDispatchInfo,
	},
	weights::Weight,
};
```

To list all the dispatch methods moved from weights crate to dispatch crate please take a look of the changes  for the `frame/support/src/dispatch.rs` file in the PR:

[https://github.com/paritytech/substrate/pull/12219/files#diff-6faadaafc4a2f7556e8ba9cf9bd8544e5c039e97441e1d470a88c296d39819ed](https://github.com/paritytech/substrate/pull/12219/files#diff-6faadaafc4a2f7556e8ba9cf9bd8544e5c039e97441e1d470a88c296d39819ed)

**(ask github to Load Diff)**

<br/>

## :warning: <span style="font-size:28px;color: #F7A76C;font-weight: 700">Medium Impact</span>

### [<span style="font-size:24px;color: #F7A76C;font-weight: 600;text-decoration: underline;">Fast Unstake Pallet</span>](https://github.com/paritytech/substrate/pull/12129)


<span style="color: #790252;font-size:18px;font-weight: 700">What is important about this new feature?</span>
This is an important change to take into account because it adds more flexibility and lower the barriers when users wants to contribute by staking their funds. Even from the builders point of view, this change does not imply any actions, we consider this change is a fundamental improvement to one of the core components that should be mentioned.

This new pallet adds the following functionality:
If a nominator has not actively backed any validators in the last `BondingDuration` (Number of eras that staked funds must remain bonded for days), then they can register themselves in this pallet. The benefit for users being registered to this queue is that they can unstake faster than having to wait an entire bonding duration, and potentially move into a nomination pool.

Accounts being registered will be queued, this queue will be processed triggering `force_unstake` call for the nominator account.:  ([https://github.com/paritytech/substrate/blob/e7f994d1e797420f252dd24714b029071ccbc46c/frame/staking/src/pallet/mod.rs#L1364](https://github.com/paritytech/substrate/blob/e7f994d1e797420f252dd24714b029071ccbc46c/frame/staking/src/pallet/mod.rs#L1364)) 

This account will join a nomination pool if a `pool_id` was provided as a parameter in the extrinsic.

This PR (included in this release) adds the pallet to all the runtimes: https://github.com/paritytech/polkadot/pull/6050

---

### [<span style="font-size:24px;color: #F7A76C;font-weight: 600;text-decoration: underline;">Rename anonymous to pure proxy</span>](https://github.com/paritytech/substrate/pull/12283)


This change only renames the `anonymous` term across the proxy pallet to the `pure` term.

<span style="color: #790252;font-size:18px;font-weight: 600">How can this change affect our builders?</span>

This change does not involve any functional changes as described before, but as it stated in the PR description, this rename might break some tooling like PolkadotJS or any other API.

**Extrinsics rename**

`anonymous` → `create_pure`

`kill_anonymous` → `pure_account`

**Pallet impl fn rename:**

`anonymous_account` → `pure_account` 

**Events rename**

`AnonymousCreated` → `PureCreated`

---

### [<span style="font-size:24px;color: #F7A76C;font-weight: 600;text-decoration: underline;">Const impls of base arithmetics for `Weights` with `u64`</span>](https://github.com/paritytech/substrate/pull/12322)

This PR is adding a simple  arithmetics methods to the Weights v2 struct that are mostly targeting constants definitions. As in Rust, the `unwrap()` is not available for const, the checked versions are currently not really usable. 

**List of methods:**

```rust
/// Constant version of Add with u64.
	///
	/// Is only overflow safe when evaluated at compile-time.
	pub const fn add(self, scalar: u64) -> Self {
		Self { ref_time: self.ref_time + scalar }
	}

	/// Constant version of Sub with u64.
	///
	/// Is only overflow safe when evaluated at compile-time.
	pub const fn sub(self, scalar: u64) -> Self {
		Self { ref_time: self.ref_time - scalar }
	}

	/// Constant version of Div with u64.
	///
	/// Is only overflow safe when evaluated at compile-time.
	pub const fn div(self, scalar: u64) -> Self {
		Self { ref_time: self.ref_time / scalar }
	}

	/// Constant version of Mul with u64.
	///
	/// Is only overflow safe when evaluated at compile-time.
	pub const fn mul(self, scalar: u64) -> Self {
		Self { ref_time: self.ref_time * scalar }
	}
```

<span style="color: #790252;font-size:18px;font-weight: 600">Why this change is important for the builders?</span>

Defining and constant values for Weights is a common practice during runtime configuration and the implementation of this methods are more adequate to constants configuration:

```rust
const MAXIMUM_BLOCK_WEIGHT: Weight = WEIGHT_PER_SECOND.mul(2);

parameter_types! {
	pub const BlockHashCount: BlockNumber = 2400;
	pub const Version: RuntimeVersion = VERSION;
	pub RuntimeBlockLength: BlockLength =
		BlockLength::max_with_normal_ratio(5 * 1024 * 1024, NORMAL_DISPATCH_RATIO);
	pub RuntimeBlockWeights: BlockWeights = BlockWeights::builder()
		.base_block(BlockExecutionWeight::get())
		.for_class(DispatchClass::all(), |weights| {
			weights.base_extrinsic = ExtrinsicBaseWeight::get();
		})
		.for_class(DispatchClass::Normal, |weights| {
			weights.max_total = Some(NORMAL_DISPATCH_RATIO * MAXIMUM_BLOCK_WEIGHT);
		})
		.for_class(DispatchClass::Operational, |weights| {
			weights.max_total = Some(MAXIMUM_BLOCK_WEIGHT);
			// Operational transactions have some extra reserved space, so that they
			// are included even if block reached `MAXIMUM_BLOCK_WEIGHT`.
			weights.reserved = Some(
				MAXIMUM_BLOCK_WEIGHT - NORMAL_DISPATCH_RATIO * MAXIMUM_BLOCK_WEIGHT
			);
		})
		.avg_block_initialization(AVERAGE_ON_INITIALIZE_RATIO)
		.build_or_panic();
}
```

Example: [HERE](https://github.com/paritytech/substrate/blob/master/bin/node/runtime/src/lib.rs#L174)

**Important consideration about why this is not catching errors explicitly:**

[https://github.com/paritytech/substrate/pull/12322#issuecomment-1256661572](https://github.com/paritytech/substrate/pull/12322#issuecomment-1256661572)

<br/>

## :information_source: <span style="font-size:28px;color: #34B3F1;font-weight: 700">Low Impact</span>

### [<span style="font-size:24px;color: #34B3F1;font-weight: 600;text-decoration: underline;">Use parameter_types instead of thread_local for test-setup</span>](https://github.com/paritytech/substrate/pull/12036)


Interesting change for setting pallet type parameters on a mocked runtime. Instead of spawning a new `thread!` which contains the type values, we can use the `parameter_types!` macro following the same process as the runtime configuration:

```rust
// Before
thread_local! {
	pub static MEMBERS: RefCell<Vec<u64>> = RefCell::new(vec![]);
}

// Now
parameter_types! {
	pub static MembersTestValue: Vec<u64> = vec![];
}
```

---

### [<span style="font-size:24px;color: #34B3F1;font-weight: 600;text-decoration: underline;">pallet-identity: Be more paranoid ;)</span>](https://github.com/paritytech/substrate/pull/12170)


Prevents sticking a tx before the approve which changes the identity info.
`provide_judgment` extrinsic now takes a new `identity` parameter.

**Details:**
    
```rust
    /// Provide a judgement for an account's identity.
    ///
    /// The dispatch origin for this call must be _Signed_ and the sender must be the account
    /// of the registrar whose index is `reg_index`.
    ///
    /// - `reg_index`: the index of the registrar whose judgement is being made.
    /// - `target`: the account whose identity the judgement is upon. This must be an account
    ///   with a registered identity.
    /// - `judgement`: the judgement of the registrar of index `reg_index` about `target`.
    /// - `identity`: The hash of the [`IdentityInfo`] for that the judgement is provided.
    ///
    /// Emits `JudgementGiven` if successful.
    ///
    /// # <weight>
    /// - `O(R + X)`.
    /// - One balance-transfer operation.
    /// - Up to one account-lookup operation.
    /// - Storage: 1 read `O(R)`, 1 mutate `O(R + X)`.
    /// - One event.
    /// # </weight>
    #[pallet::weight(T::WeightInfo::provide_judgement(
    	T::MaxRegistrars::get(), // R
    	T::MaxAdditionalFields::get(), // X
    ))]
    pub fn provide_judgement(
    	origin: OriginFor<T>,
    	#[pallet::compact] reg_index: RegistrarIndex,
    	target: AccountIdLookupOf<T>,
    	judgement: Judgement<BalanceOf<T>>,
    	identity: T::Hash,
    ) -> DispatchResultWithPostInfo {
    	// --snip
    }
    ```
    

And adds a new error for the pallet:

```rust
/// The provided judgement was for a different identity.
		JudgementForDifferentIdentity,
```

**Solution for the following problem:**

A user can call `set_identity` and `request_judgement` with a valid identity and convince the registrar that this identity is correct. After that the registrar will submit a call to `provide_judgement` with a positive `Judgement`.
 However, this call is not bound to the confirmed identity, the meaning of this call can be summarized as "I confirm that the identity set by `target` is correct."
